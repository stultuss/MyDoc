HTTP 基础
=========================

> 记录日常工作中的一些问题
>
> https://www.jianshu.com/p/8565912949bb

##TCP / IP 协议组

TCP / IP 是一个协议组，一共分为四层：链路层，网络层，传输层和应用层。

- 链路层：负责在以太网，WiFi 的底层网络上发送原始数据包，使用 MAC 地址来标记设备。

- 网络层：根据 IP 协议，在这一层上会用 IP 地址取代了 MAC 地址，组成了虚拟网络（广域网，局域网），这一层还包含了  ICMP 协议， ARP 协议，RARP 协议。
- 传输层：这一层的协议的指责是保证数据在两个 IP 间可靠的传输。是 TCP 协议和 UDP 协议工作的层次。
- 应用层：这一层主要都是面向具体应用的协议，包含 FTP，HTTP，TELNET，SMTP，DNS 等

还有一种网络分层模型是：OSI 网络分层，也就是传统的 **七层模型**，而 TCP/IP 是 **四层模型**。

### TCP 协议

TCP 协议提供的是面向连接，可靠的字节流服务。

- 在交换数据之前，通过三次握手建立连接。
- 交换的数据是顺序的，且不会重复的，可以进行大数据传输。
- 不限制数据的大小，TCP 数据包是分包传输的，一个包的大小为 1522 字节（head 共 22 字节，payload 为1500 字节）

TCP 的三次握手：

- 第一次握手：客户端发送 syn 包(syn=j)，并进入 SYN_SEND 状态，等待服务器确认。
- 第二次握手：服务端收到客户端的 syn 包，确认客户端的 SYN 包(syn=j+1)，同时自己也发送一个 syn 包 （syn=k，SYN+ACK 包），服务器进入 SYN_RECV 状态。
- 第三次握手：客户端收到服务端的 syn 包，向服务器发送确认包（ack=k+1，ACK包）发送完毕，客户端和服务器进入ESTABLISHED 状态。完成三次握手。

TCP 的数据交换也需要用到 ACK 确认，客户端每收到两个 TCP 数据包，就会发送一条确认消息（ACK），包含：

- 期待下个数据包的编号（确保有序性和包的完整性，防止服务端发送后丢包）
- 接收窗口的剩余容量（确保服务端发送的速率不会超过上限，TCP 慢启动机制）

### UDP 协议

UDP协议提供的是一个无连接协议，每一个数据报都是独立的信息，包含完整的源地址和目的地址。因此是否能到达目的地，以及到达目的地的时间以及内容的正确性无法保证。

- 通信之前不需要连接，所以可以实现广播发送。
- 传输的数据有大小限制，数据报必须限定在 64 KB 以内。
- 无法保证数据的先后顺序。
- 通常用于多点通信和实时的数据业务。

## HTTP 协议

HTTP 协议是建立在 TCP 协议之上的一种应用，连接使用的是 **请求-响应** 的方式。不仅在请求时需要建立 TCP 连接，还需要客户端在向服务器发出请求后，请求中要包含`请求方法`，`URI`，`协议版本`以及`其他相关的 MIME 样式`的消，服务端才能回复数据。在请求结束后就会主动释放连接没，因此 HTTP 是一种短连接。

> 需要注意的是 HTTP/1.0 为每一次的 HTTP 请求/响应建立一条新的 TCP 链接，因此一个包含 HTML 内容和图片的页面将需要建立多次的短期的 TCP 链接，并且每个 TCP 链接的建立都需要 3 次握手。（HTTP/1.1 后提出可持续链接（keeplive），HTTP/2.0 后提出多路复用都可以重复使用传输消息，减少链接建立次数和开销）